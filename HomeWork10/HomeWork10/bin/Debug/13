(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-586614ff"],{"0e29":function(t,e,s){"use strict";s("b3a9")},"1c79":function(t,e,s){"use strict";s("5144")},5144:function(t,e,s){},"72ef":function(t,e,s){},7844:function(t,e,s){"use strict";s("dbac")},"7a35":function(t,e,s){"use strict";s("98cb")},8839:function(t,e,s){"use strict";s("72ef")},"98cb":function(t,e,s){},a06b:function(t,e,s){},b3a9:function(t,e,s){},beda:function(t,e,s){"use strict";s("a06b")},dbac:function(t,e,s){},df50:function(t,e,s){"use strict";s.r(e);var n=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"index-box"},[s("div",{staticClass:"indexPage",class:{smIndexPage:t.smheight}},[s("div",{staticClass:"left-menu"},[s("nav-bar",{attrs:{chatlist:t.chatlist,userMsg:t.userMsg},on:{menuChange:t.menuChange,chatScroll:t.chatScroll}})],1),s("div",{staticClass:"right-content"},[s("router-view"),t.$route.params.id?t._e():s("blank-component"),s("prompt",{attrs:{show:t.promptShow,text:t.promptData.tips},on:{close:t.promptClose}},[0==t.promptData.relation?s("a",{staticClass:"prompt-btn",attrs:{role:"button"},on:{click:t.promptConfirm}},[t._v("关注")]):t._e(),3==t.promptData.relation?s("a",{staticClass:"prompt-btn",attrs:{role:"button"},on:{click:t.promptConfirm}},[t._v("回关")]):t._e()])],1)]),s("red-envolope",{attrs:{show:t.menu.showEnvolope,msgObj:t.menu.envolopeMsg},on:{closeView:function(e){t.menu.showEnvolope=!1}}})],1)},a=[],i=s("cd6d"),o=s("15f8"),r=(s("d60d"),s("6a61"),function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"leftMenu clearTpaErr"},[s("div",{staticClass:"title-box"},[s("div",{staticClass:"user-msg"},[s("img",{attrs:{src:t.userMsg.userImg},on:{click:function(e){return e.stopPropagation(),t.openUrl("https://i.csdn.net")}}}),s("span",{staticClass:"userName"},[t._v(t._s(t.user.userNickname||t.userMsg.userName))])]),s("div",{staticClass:"right-btn"},[s("div",{staticClass:"btn-private"},[s("setting",{on:{click:function(e){return e.preventDefault(),e.stopPropagation(),t.getAttention.apply(null,arguments)}}}),t.pullboxshow?s("div",{ref:"pullbox",staticClass:"pull_box",on:{click:function(e){return e.preventDefault(),e.stopPropagation(),t.setAttention(t.attentionMsg)}}},[t._v(" "+t._s((t.attentionMsg?"允许":"拒绝")+"陌生人私信我")+" ")]):t._e()],1)])]),s("div",{directives:[{name:"show",rawName:"v-show",value:t.chatlist.length,expression:"chatlist.length"}],ref:"chatList",staticClass:"chat-list"},[s("context-menu",{ref:"contextMenuRef",attrs:{target:t.$refs.chatList}},[[s("context-item",{on:{click:function(e){return t.openUrl("https://me.csdn.net/"+t.contextMenuData.username)}}},[t._v("进入个人主页")]),s("context-item",{on:{click:function(e){return t.setDigitalShow(t.contextMenuData)}}},[t._v(" "+t._s(t.contextMenuData.digitalShow?"消息免打扰":"取消免打扰")+" ")]),s("context-item",{on:{click:function(e){return t.delChatItem(t.contextMenuData)}}},[t._v("删除对话")])]],2),s("vuescroll",{staticClass:"chatListMenu",attrs:{ops:t.menu.scrollOps}},t._l(t.chatlist,(function(e,n){return s("div",{key:e.username,staticClass:"msg-item",class:{"active-msg-item":t.cpWithLowcase(t.user.chatUserName,e.username),"is-top":!!e.setTop},on:{contextmenu:function(s){return s.preventDefault(),t.contextMenuHandle(e,n)},click:function(s){return s.preventDefault(),t.selectMenu(e,n)}}},[0!==n||t.isContextMenuClick?t._e():s("div",{staticClass:"right-context-tip"},[s("div",{staticClass:"tip-text"},[s("span",[t._v("选中后，右键展开更多操作")]),s("a",{staticClass:"tip-btn",attrs:{role:"button"},on:{click:t.contextMenuClick}},[t._v("知道了")])])]),s("div",{staticClass:"left"},[s("div",{staticClass:"headimg"},[s("img",{attrs:{src:e.avatar}}),e.identity&&e.identity.length?s("div",{staticClass:"user-title"},[s("img",{attrs:{src:e.identity[0].icon}})]):t._e(),e.unReadCount>0?s("div",{staticClass:"unread-num"},[t._v(" "+t._s(e.digitalShow?e.unReadCount>99?"99+":e.unReadCount:"")+" ")]):t._e()])]),s("div",{staticClass:"right"},[s("div",{staticClass:"r-left"},[s("div",{staticClass:"who-name"},[s("span",{staticClass:"who-msg",class:{"who-msg-norela":!t.explainRelation(e.relation)}},[t._v(t._s(e.nickname||e.username))]),t.explainRelation(e.relation,e.official)?s("span",{staticClass:"msg-relation",class:["relation-"+(e.official?"0":e.relation)]},[t._v(t._s(t.explainRelation(e.relation,e.official)))]):t._e()]),s("div",{staticClass:"time"},[t._v(t._s(t.getlastMsgTime(e)))])]),s("div",{staticClass:"r-right"},[s("p",{staticClass:"last-msg",domProps:{innerHTML:t._s(t.formatMsg(e))}}),s("div",{staticClass:"session-status"},[e.hasReplied?s("span",{staticClass:"readed"}):t._e(),e.digitalShow?t._e():s("span",{staticClass:"shield-disabled"})])])])])})),0)],1),s("div",{directives:[{name:"show",rawName:"v-show",value:!t.chatlist.length,expression:"!chatlist.length"}],staticClass:"blankview"},[t._v(t._s(t.user.blankText))])])}),c=[],u=(s("9896"),s("f416"),s("f6e5"),s("8cbc")),l=(s("f18c"),["class","staticClass","style","staticStyle","attrs"]),h={functional:!0,render:function(t,e){var s=e._c,n=(e._v,e.data),a=e.children,i=void 0===a?[]:a,r=n.class,c=n.staticClass,h=n.style,d=n.staticStyle,m=n.attrs,p=void 0===m?{}:m,g=Object(u["a"])(n,l);return s("svg",Object(o["a"])({class:[r,c],style:[h,d],attrs:Object.assign({xmlns:"http://www.w3.org/2000/svg",width:"36",height:"36"},p)},g),i.concat([s("image",{attrs:{width:"36",height:"36",href:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACQAAAAkCAQAAABLCVATAAAABGdBTUEAALGPC/xhBQAAACBjSFJN AAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAAmJLR0QA/4ePzL8AAAAHdElN RQfkBw0FEgPmfRR7AAABKklEQVRIx+2WMUsDQRCFv9k7SLCKjYK2iqCgIAFLbYKFdSpBiOZ+xImd QvAv3KmFWNiqhdgKglYmaZKzSBPtrSQBc2Nxim0Wtkhxr9u38DFvl90ZUdzIB7iYGy0DSLf+ntln qzpjAenVeqKcL4xaTAHIQNbrHYgDjazK+fa2DKSLGQa0mC4B6JptLl3xIXiIG5QRVJvTdwDFxrDE 7PgcTdIrcXXYxhEnB+WgyQL5ANGOKadilGb9BuC+0N8f/60Z1SS4FiXa4PnP9DYPHiE+1iPLYFVn 0UTdRXOjybv+HJSDXMgHTHyStWxeS4fVEVzOD08tWrZqm9CHeFvDX6vy+cQtDEJ2rcqp8GJA3/jK 1jLwEgBpWeYa0hXlf9AqdPY+sh3LQSup9Z19Iz/TvGe2Syx6JgAAACV0RVh0ZGF0ZTpjcmVhdGUA MjAyMC0wNy0xMlQyMToxODowMyswODowMFxZs/cAAAAldEVYdGRhdGU6bW9kaWZ5ADIwMjAtMDct MTJUMjE6MTg6MDMrMDg6MDAtBAtLAAAAIHRFWHRzb2Z0d2FyZQBodHRwczovL2ltYWdlbWFnaWNr Lm9yZ7zPHZ0AAAAYdEVYdFRodW1iOjpEb2N1bWVudDo6UGFnZXMAMaf/uy8AAAAXdEVYdFRodW1i OjpJbWFnZTo6SGVpZ2h0ADM2L5k87QAAABZ0RVh0VGh1bWI6OkltYWdlOjpXaWR0aAAzNtc2/GAA AAAZdEVYdFRodW1iOjpNaW1ldHlwZQBpbWFnZS9wbmc/slZOAAAAF3RFWHRUaHVtYjo6TVRpbWUA MTU5NDU1OTg4M2pkp90AAAARdEVYdFRodW1iOjpTaXplADY4NEJC81CLlwAAAEZ0RVh0VGh1bWI6 OlVSSQBmaWxlOi8vL2FwcC90bXAvaW1hZ2VsYy9pbWd2aWV3Ml85XzE1OTI5MjE4NDU1MzQwNTcz XzE1X1swXURAiiIAAAAASUVORK5CYII="}})]))}},d=s("b74f"),m=s("c841"),p=s("90bf"),g=s("7736"),f=s("e04f"),v=s.n(f),b=s("1531"),C=s.n(b),w=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{ref:"contextMenuRef",staticClass:"context-menu",style:t.layout},[t._t("default")],2)},x=[],k={props:{target:{type:HTMLElement,default:function(){return document.body}}},data:function(){return{show:!1,left:null,top:null}},mounted:function(){this.registerHandlers()},destoryed:function(){this.removeEventListener()},computed:{layout:function(){return{position:"fixed",visibility:this.show?"visible":"hidden",left:this.left,top:this.top}}},methods:{handleContextClick:function(t){var e=this;t.preventDefault(),t.stopPropagation();var s=t.clientX||t.touches&&t.touches[0].pageX,n=t.clientY||t.touches&&t.touches[0].pageY;this.$nextTick((function(){var t=window.innerHeight,a=e.$refs.contextMenuRef.clientHeight;n+a>t&&(n=t-a),e.left=s+"px",e.top=n+"px",e.showMenu()}))},registerHandlers:function(){var t=this;document.addEventListener("mousedown",this.handleOutsideClick),document.addEventListener("touchstart",this.handleOutsideClick),document.addEventListener("scroll",this.hideMenu),document.addEventListener("contextmenu",this.hideMenu),window.addEventListener("resize",this.hideMenu),this.$nextTick((function(){t.target.addEventListener("contextmenu",t.handleContextClick)}))},unregisterHandlers:function(){document.removeEventListener("mousedown",this.handleOutsideClick),document.removeEventListener("touchstart",this.handleOutsideClick),document.removeEventListener("scroll",this.hideMenu),document.removeEventListener("contextmenu",this.hideMenu),window.removeEventListener("resize",this.hideMenu),this.target&&this.target.removeEventListener("contextmenu",this.handleContextClick)},handleOutsideClick:function(t){this.$refs.contextMenuRef&&!this.$refs.contextMenuRef.contains(t.target)&&this.hideMenu()},hideMenu:function(){this.left=null,this.top=null,this.show=!1},showMenu:function(){this.show=!0}}},y=k,A=(s("beda"),s("4ac2")),O=Object(A["a"])(y,w,x,!1,null,"62207eac",null),_=O.exports,S=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"context-item",on:{click:t.handleClick}},[t._t("default")],2)},M=[],j={methods:{handleClick:function(){this.$emit("click")}}},T=j,I=(s("7844"),Object(A["a"])(T,S,M,!1,null,"5dad3220",null)),R=I.exports,D=s("8897"),E={name:"",data:function(){return{pullboxshow:!1,attentionMsg:!1,cpWithLowcase:p["f"],contextMenuData:{},ReleationDict:D["b"],isContextMenuClick:!0}},components:{setting:h,vuescroll:C.a,contextMenu:_,contextItem:R},props:["chatlist","userMsg"],created:function(){var t=this;m["a"].getGuideFlag().then((function(e){t.isContextMenuClick=!e.data})),this.getUserInfo()},mounted:function(){this.hideAlertBox("pullbox");var t=this.$refs.chatList.querySelector(".chatListMenu .__panel");t.addEventListener("scroll",this.handlerScroll)},updated:function(){},methods:Object(o["a"])(Object(o["a"])(Object(o["a"])({},Object(g["d"])(["deleteSession"])),Object(g["b"])(["syncUnreadCount","getPagingChatlist"])),{},{isEmoji:p["k"],buildEmoji:p["c"],openUrl:p["l"],handlerScroll:function(t){var e=t.target,s=e.innerHeight||e.clientHeight,n=e.scrollTop;e.scrollHeight-s-n<=0&&this.user.chatListCfg.hasNext&&!this.user.chatListCfg.isLoading&&(++this.user.chatListCfg.pageNum,this.$emit("chatScroll"))},contextMenuHandle:function(t,e){t.username!==this.contextMenuData.username&&(this.contextMenuData=t)},contextMenuClick:function(){m["a"].updateGuideFlag().then((function(t){})),this.isContextMenuClick=!0},explainRelation:function(t,e){return e&&(t=0),this.ReleationDict.hasOwnProperty(t)?this.ReleationDict[t]:""},getUserInfo:function(){var t=this;m["a"].getUserInfoById(v.a.get("UserName")).then((function(e){var s=e.data.data;s.username&&(t.user.userNickname=s.nickname)}))},getAttention:function(){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function e(){var s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,m["a"].getAttention();case 2:s=e.sent,t.attentionMsg=s.data.isSetAttention,t.pullboxshow=!0;case 5:case"end":return e.stop()}}),e)})))()},setAttention:function(t){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function s(){var n;return regeneratorRuntime.wrap((function(s){while(1)switch(s.prev=s.next){case 0:return s.next=2,m["a"][t?"cancelSetAttention":"setAttention"]();case 2:n=s.sent,e.pullboxshow=!1,0===+n.code&&e.$message({message:t?"允许陌生人私信我设置成功":"拒绝陌生人私信我设置成功",type:"success"});case 5:case"end":return s.stop()}}),s)})))()},blackUser:function(t){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function s(){return regeneratorRuntime.wrap((function(s){while(1)switch(s.prev=s.next){case 0:return s.next=2,d["a"].blackUser({blackUsername:t.usernmae});case 2:e.setCurChatShield(!0);case 3:case"end":return s.stop()}}),s)})))()},selectMenu:function(t,e){if(Object(p["f"])(this.user.chatUserName,t.username))return!1;this.user.curChatImg=t.avatar,this.user.chatName=t.nickname,this.user.chatUserName=t.username,this.user.curUser=t,this.$emit("menuChange",t),this.$router.replace("/chat/"+t.username)},showDel:function(t){$(".msg-item .right .more-actions-box").hide();var e=$(t.target).parents(".msg-item");e.find(".right .more-actions-box").show()},delChatItem:function(t,e){var s=this;if(!t.content)return this.deleteSession(t),this.closeContextMenu(),void(Object(p["f"])(t.username,this.$route.params.id)&&(this.user.curChatImg=this.user.chatName=this.user.chatUserName="",this.$router.replace("/chat/")));this.$confirm("删除后将清空对话的消息记录","删除对话",{confirmButtonText:"确定",cancelButtonText:"取消"}).then((function(){d["a"].delSession({fromUsername:t.username}).then((function(e){0===+e.code&&(s.deleteSession(t),s.closeContextMenu(),s.chatlist&&0!==s.chatlist.length||(s.user.blankText="暂无最近联系人哦"),s.syncUnreadCount(),Object(p["f"])(t.username,s.$route.params.id)&&(s.user.curChatImg=s.user.chatName=s.user.chatUserName="",s.$router.replace("/chat/")))}))}))},setDigitalShow:function(t){var e=this;d["a"].setDigitalRemind({targetUsername:t.username,switchType:0,isOpen:!t.digitalShow}).then((function(s){0===+s.code&&(e.closeContextMenu(),t.digitalShow=!t.digitalShow)}))},setTop:function(t){var e=this;d["a"].setDigitalRemind({targetUsername:t.username,switchType:t.setTop?0:1,isOpen:t.digitalShow}).then((function(t){0===+t.code?(e.closeContextMenu(),e.getPagingChatlist()):e.$message({message:t.message,type:"error"})}))},goUserCenter:function(t){},hideAlertBox:function(t){var e=this;document.addEventListener("mouseup",(function(s){var n=e.$refs[t];n&&n.contains&&!n.contains(s.target)&&(e.pullboxshow=!1);var a=$(".msg-item .right .more-actions-box:visible").prev()[0];a&&!a.contains(s.target)&&$(".msg-item .right .more-actions-box").hide()}))},getlastMsgTime:function(t){return t.createTime?Object(p["o"])(+t.createTime):""},formatMsg:function(t){return t.content?Object(p["k"])(t.content)?Object(p["c"])(t.content):t.content:""},closeContextMenu:function(){this.$refs.contextMenuRef.hideMenu(),this.contextMenuData={}}}),watch:{"user.chatUserName":{handler:function(t,e){var s=this;if(t&&t!==e){var n=this.chatlist.find((function(e){return e.username===t}));!n||n.unReadCount<=0||d["a"].cleanMsg({toUsername:this.user.userName,fromUsername:n.username}).then((function(t){0===+t.code&&(n.unReadCount=0,s.syncUnreadCount())}))}}}},computed:Object(o["a"])({},Object(g["e"])(["user","menu"]))},N=E,B=(s("fb44"),Object(A["a"])(N,r,c,!1,null,"256bd1d0",null)),U=B.exports,L=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"blank_list"},[t._v(" 您还未选中或者发起聊天，快去跟好友聊一聊吧 ")])},H=[],W={name:"blank-component",data:function(){return{}}},P=W,V=(s("7a35"),Object(A["a"])(P,L,H,!1,null,"286e2998",null)),F=V.exports,z=s("b77c");function Z(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Y(t,e){for(var s=0;s<e.length;s++){var n=e[s];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function G(t,e,s){return e&&Y(t.prototype,e),s&&Y(t,s),t}s("0cf6"),s("c34a");var Q=function(){function t(e){Z(this,t),this.messageHandle=e.messageHandle,this.UserName=v.a.get("UserName")||"",this.deviceId=v.a.get("uuid_tt_dd")||"default",this.appId=e.appId,this.groupId=e.groupId,this.chatSocket=null,this.wsConnectStatus=0,this.testMsg=null,this.wsUrl=null,this.lockReconnect=!1,this.tt=null,this.timeout=5e3,this.timeoutObj=null,this.serverTimeoutObj=null,this.connectInfo=null,this.channelType="privateMsg",this.getIMtoken(),this.common_data=null}return G(t,[{key:"getMessageList",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e={pageNum:1,pageSize:20,liveId:this.liveId,sort:"desc"};return d["a"].messageList(Object.assign({},e,t))}},{key:"getIMtoken",value:function(){var t=Object(i["a"])(regeneratorRuntime.mark((function t(){var e,s,n,a,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e=this.UserName||"",s="",e){t.next=15;break}return t.prev=3,t.next=6,d["a"].fkUser({deviceId:this.deviceId,appId:this.appId});case 6:n=t.sent,n&&n.data&&(e=n.data.id,s=n.data.token),t.next=15;break;case 11:t.prev=11,t.t0=t["catch"](3),e="",s="";case 15:if(e){t.next=17;break}return t.abrupt("return");case 17:a=[],document.cookie.split("; ").forEach((function(t){t.indexOf("utm_")>-1&&a.push(t.split("=")[0])})),i={appId:this.appId,userId:e||"",token:s||"",groupId:this.groupId,linkType:1,deviceId:this.deviceId,channelType:this.channelType},this.connectInfo=i,this.webSocketConnect();case 22:case"end":return t.stop()}}),t,this,[[3,11]])})));function e(){return t.apply(this,arguments)}return e}()},{key:"webSocketConnect",value:function(){var t=this,e=this,s=this.connectInfo;d["a"].getIMtoken(s).then((function(n){if(n&&200===+n.code){t.wsUrl="wss://".concat(n.data.linkServers[0]),t.testMsg=JSON.stringify({ver:"1.0",cmdId:2,isZip:0,body:{userId:s.userId,appId:e.appId,imToken:n.data.imToken,groupId:e.groupId}});try{t.chatSocket=new WebSocket(t.wsUrl),t.webSocketInit()}catch(a){t.webSocketReconnect()}}}),(function(e){t.webSocketReconnect()}))}},{key:"webSocketReconnect",value:function(){var t=this;this.wsConnectStatus>0||this.lockReconnect||(this.lockReconnect=!0,this.tt&&clearTimeout(this.tt),this.tt=setTimeout((function(){t.webSocketConnect(),t.lockReconnect=!1}),3e3))}},{key:"webSocketInit",value:function(t){var e=this;this.wsConnectStatus=1,this.chatSocket.onopen=function(t){e.wsConnectStatus=2,e.chatSocket.send(e.testMsg)},this.chatSocket.onmessage=function(t){e.wsConnectStatus=2,e.onMessage(t.data),e.heartCheck()},this.chatSocket.onerror=function(t){e.onMessage({cmdId:-1,msg:"ws 连接失败"}),e.wsConnectStatus=-1,e.webSocketReconnect()},this.chatSocket.onclose=function(t){e.onMessage({msg:"ws 连接关闭"}),e.wsConnectStatus=-1,e.webSocketReconnect()};var s=this;window.onbeforeunload=function(){try{s.closeWebsocket()}catch(t){}}}},{key:"onMessage",value:function(t){var e="string"===typeof t?JSON.parse(t):t;e.cmdId,5===+e.cmdId&&2===this.wsConnectStatus&&(this.wsConnectStatus=3),"function"===typeof this.messageHandle&&this.messageHandle(e)}},{key:"closeWebsocket",value:function(){this.chatSocket.close(),this.wsConnectStatus=0}},{key:"heartbeat",value:function(){var t=this;3===this.wsConnectStatus&&(this.chatSocket.send('{"cmdId":1}'),setTimeout((function(){t.heartbeat()}),3e4))}},{key:"heartCheck",value:function(){var t=this;this.timeoutObj&&clearTimeout(this.timeoutObj),this.serverTimeoutObj&&clearTimeout(this.serverTimeoutObj),this.timeoutObj=setTimeout((function(){t.chatSocket.send('{"cmdId":1}'),t.serverTimeoutObj=setTimeout((function(){t.chatSocket.close()}),t.timeout)}),this.timeout)}}]),t}(),X=function(){var t=this,e=t.$createElement,s=t._self._c||e;return t.show?s("div",{staticClass:"redEnvolope"},[s("div",{staticClass:"env-box"},[s("div",{ref:"showView",staticClass:"env-container"},[t.showOpen?s("div",{staticClass:"pre-open"},[s("div",{ref:"red-top",staticClass:"top"},[s("header",[s("img",{staticClass:"clearTpaErr",attrs:{src:t.msgObj.avatar,alt:""}}),s("span",[t._v(t._s(t.msgObj.messageBody.fromNickname||t.msgObj.fromUsername)+"的红包")])]),s("div",{staticClass:"contain"},[t._v(t._s(t.msgObj.messageBody.title))]),s("div",{staticClass:"bot-icon"})]),s("footer",{ref:"red-bot"},[t._m(0),s("div",{staticClass:"red-openbtn",class:{"open-start":!t.opBtn,"rotate-start":t.opBtn,"red-hidebtn":t.showBtn},on:{click:function(e){return e.stopPropagation(),t.openBasket.apply(null,arguments)}}})])]):s("div",{staticClass:"opened"},[s("div",{staticClass:"bot-icon"}),s("header",[s("div",{staticClass:"left clearTpaErr"},[s("img",{staticClass:"clearTpaErr",attrs:{src:t.msgObj.avatar,alt:""}})]),s("div",{staticClass:"right"},[s("p",{staticClass:"who"},[t._v(t._s(t.msgObj.messageBody.fromNickname||t.msgObj.fromUsername)+"的红包")]),s("p",{staticClass:"desc"},[t._v(t._s(t.msgObj.messageBody.title))])])]),s("div",{staticClass:"contain-box"},[1===t.curType?s("div",{staticClass:"first-claim"},[s("p",[t._v("恭喜你获得")]),s("p",[s("span",{staticClass:"money"},[t._v(t._s(t.msgObj.messageBody.money&&t.msgObj.messageBody.money/100||"0.00"))]),s("span",{staticClass:"m-type"},[t._v("元")])]),t._m(1)]):t._e(),2===t.curType?s("div",{staticClass:"red-invalid"},[t._v(" 红包已失效 ")]):t._e(),5===t.curType?s("div",{staticClass:"first-claim red-overdue"},[s("p",[s("span",{staticClass:"money"},[t._v(t._s(t.msgObj.messageBody.money&&t.msgObj.messageBody.money/100||"0.00"))]),s("span",{staticClass:"m-type"},[t._v("元")])]),s("p",{staticClass:"msg-back"},[t._v("红包已退回")]),s("p",{staticClass:"msg-time"},[t._v(t._s(t.transTime(t.msgObj.messageBody.endTime)))])]):t._e(),3===t.curType?s("div",{staticClass:"own-unclaimed"},[s("div",{staticClass:"unclaimed-box"},[t._v(" 红包金额"+t._s(t.msgObj.messageBody.money&&t.msgObj.messageBody.money/100||"0.00")+"元，等待对方领取 ")]),s("footer",[t._v("未领取的红包，将于24小时后发起退款")])]):t._e(),4===t.curType?s("div",{staticClass:"own-unclaimed received-list"},[s("div",{staticClass:"unclaimed-box"},[t._v(" "+t._s(t.msgObj.receives.length)+"个红包共"+t._s(t.msgObj.messageBody.money&&t.msgObj.messageBody.money/100||"0.00")+"元 ")]),s("div",{staticClass:"red-boxlist-box"},t._l(t.msgObj.receives,(function(e,n){return s("div",{key:n,staticClass:"red-boxlist"},[s("div",{staticClass:"left"},[s("div",{staticClass:"img"},[s("img",{staticClass:"clearTpaErr",attrs:{src:e.fromAvatar,alt:""}})]),s("div",{staticClass:"user-msg"},[s("div",{staticClass:"u-name"},[s("div",{staticClass:"lft"},[t._v(t._s(e.nickName||e.username))]),s("div",{staticClass:"rht"},[t._v(t._s(e.money/100)+"元")])]),s("p",{staticClass:"u-time"},[t._v(t._s(t.transTime(e.receiveTime)))])])])])})),0)]):t._e()])])]),s("div",{staticClass:"close-btn"})])]):t._e()},J=[function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"f-top"},[s("div",{staticClass:"bot-icon"})])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("p",[t._v("已存入"),s("a",{attrs:{href:"https://i.csdn.net/#/wallet/index",target:"_blank"}},[t._v("我的钱包")])])}],K=s("1272"),q=s("15bd"),tt=(s("0cea"),s("a500"),s("147f"),s("ddef"),s("897d")),et=s.n(tt),st={data:function(){return{transTime:p["g"],opBtn:!1,showOpen:!1,showBtn:!1,moneyNum:0,timeDelay:600,curType:1}},components:{},props:["show","msgObj"],created:function(){},mounted:function(){this.setHide("showView")},methods:Object(o["a"])(Object(o["a"])({},Object(g["d"])(["updateChatlist"])),{},{sendInfoMsg:function(t){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function s(){var n,a,i,o,r;return regeneratorRuntime.wrap((function(s){while(1)switch(s.prev=s.next){case 0:return n=new FormData,n.append("toUsername",e.$route.params.id),n.append("messageType",2),n.append("messageBody",JSON.stringify(t)),n.append("fromClientType","WEB"),n.append("fromDeviceId",v.a.get("uuid_tt_dd")||"default"),n.append("appId","CSDN-PC"),n.append("extBody",JSON.stringify(t)),a=0,i=(new Date).getTime(),o={createTime:i,fromUsername:e.user.userName,id:i,messageBody:t,messageType:2,toUsername:e.$route.params.id,updateTime:i,errSend:a,fromAvatar:e.user.userImg,isread:!0,ttye:"send"},s.next=13,d["a"].sendMessage(n);case 13:r=s.sent,0!==+r.code&&(a=1),r.data&&(o.createTime=r.data.time,o.id=r.data.messageId,o.updateTime=r.data.time);case 17:case"end":return s.stop()}}),s)})))()},checkBasketIsMe:function(t){return Object(p["f"])(t.fromUsername,v.a.get("UserName"))},close:function(){this.$emit("closeView")},setHide:function(t,e){var s=this;document.addEventListener("mouseup",(function(n){var a=s.$refs[t];a&&(a.contains(n.target)||(s.close(),"function"===typeof e&&e()))}))},getMd5Str:function(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"0k7dqV7gR6SG3rSC",n="",a=Object.entries(e).sort((function(t,e){return t[0].charCodeAt()-e[0].charCodeAt()})),i=Object(q["a"])(a.entries());try{for(i.s();!(t=i.n()).done;){var o=Object(K["a"])(t.value,2),r=o[1];n+="".concat(r[0],"=").concat(r[1],"&")}}catch(c){i.e(c)}finally{i.f()}return n+="SignKey=".concat(s),et()(n)},openBasket:function(){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function e(){var s,n,a,i,o,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return s=t.$refs["red-top"],n=t.$refs["red-bot"],t.opBtn=!0,Object(p["a"])(1e3).then((function(){t.showBtn=!0})),a={orderNo:t.msgObj.messageBody.orderNo,username:t.user.userName},i={"Content-Type":"application/json;charset=UTF-8","X-App-ID":"CSDN-PC","X-Device-ID":v.a.get("uuid_tt_dd")||"default",requestID:t.getMd5Str(a)},e.next=8,d["a"].receiveRedPacket(a,i);case 8:if(o=e.sent,200!==+o.code){e.next=15;break}t.msgObj.messageBody.money=100*o.data.redPacketMoney,r={textType:1,flag:"REDPACKET_RECEIVED"},t.sendInfoMsg(r),e.next=18;break;case 15:return t.$message({message:o.message,type:"error"}),t.close(),e.abrupt("return",!1);case 18:setTimeout((function(){$(s).animate({top:"-325px"},t.timeDelay),$(n).animate({bottom:"-200px"},t.timeDelay),Object(p["a"])(t.timeDelay).then((function(){t.showOpen=!1}))}),1e3);case 19:case"end":return e.stop()}}),e)})))()}}),watch:{$route:{handler:function(t,e){},immediate:!0},show:function(t,e){t||(this.opBtn=!1,this.showOpen=!0,this.showBtn=!1),this.checkBasketIsMe(this.msgObj)?(this.showOpen=!1,this.msgObj.receiveStatus?this.curType=4:this.msgObj.isOverdue?this.curType=5:this.curType=3):(this.showOpen=!1,this.msgObj.receiveStatus?this.curType=4:this.msgObj.isOverdue?this.curType=2:(this.curType=1,this.showOpen=!0))}},computed:Object(o["a"])({},Object(g["e"])(["user"]))},nt=st,at=(s("0e29"),Object(A["a"])(nt,X,J,!1,null,"6d943c1d",null)),it=at.exports,ot=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("transition",[t.show?s("div",{staticClass:"msg-prompt"},[s("i",{staticClass:"prompt-close el-message-box__close el-icon-close",on:{click:function(e){return t.$emit("close")}}}),s("div",{staticClass:"prompt-main"},[s("span",{staticClass:"prompt-text"},[t._v(t._s(t.text))]),t._t("default")],2)]):t._e()])},rt=[],ct={props:{text:String,show:Boolean},mounted:function(){},methods:{}},ut=ct,lt=(s("8839"),Object(A["a"])(ut,ot,rt,!1,null,"36fd5082",null)),ht=lt.exports,dt={data:function(){return{id:1,chat:null,isSending:!1,chatName:"",userMsg:{userName:"cpongo6",userImg:""},smheight:!1,unReadCount:0,promptShow:!1,promptData:{}}},components:{navBar:U,blankComponent:F,rightContent:z["default"],redEnvolope:it,prompt:ht},props:[],created:function(){var t=this;this.user.chatlist=[],Object(p["a"])(500).then((function(){t.getPagingChatlist().then((function(e){t.chatInit(),!e.length&&(t.user.blankText="暂无最近联系人哦")}))}))},mounted:function(){var t=this;this.userMsg.userName=this.user.userName,this.userMsg.userImg=this.user.userImg,window.onload=function(){t.$nextTick().then((function(){setTimeout(t.changeSize,500)}))},window.onresize=Object(p["n"])(this.changeSize,500)},computed:Object(o["a"])(Object(o["a"])({},Object(g["e"])(["user","menu"])),{},{chatlist:function(){return this.user.chatlist}}),methods:Object(o["a"])(Object(o["a"])(Object(o["a"])({checkChatHeight:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:".leftMenu .chat-list",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:".leftMenu .chat-list .msg-item",s=$(e).length?$(e)[0].clientHeight:68,n=Math.ceil($(t)[0].clientHeight/s),a=this.user.chatlist.length<this.user.chatListCfg.defaultSize?this.user.chatListCfg.defaultSize:this.user.chatlist.length;if(!(n>a))return!1;this.user.chatListCfg=Object(o["a"])(Object(o["a"])({},this.user.chatListCfg),{pageNum:1,pageSize:n+1,isLoading:!1,hasNext:!0}),this.user.chatlist=[],this.user.curChatImg="",this.getPagingChatlist()},chatScroll:function(){this.getPagingChatlist()},changeSize:function(){var t=document.documentElement.clientHeight||document.body.clientHeight;this.smheight=t<850,this.checkChatHeight()}},Object(g["d"])(["updateChatlist","updateChatUserRelation"])),Object(g["b"])(["getPagingChatlist"])),{},{chatInit:function(){if(window.chat&&!this.chat)return this.chat=window.chat,!1;if(this.chat)return!1;var t=new Q({appId:"CSDN-PC",groupId:"CSDN-private-MSG",messageHandle:this.messageHandle.bind(this)});window.chat=this.chat=t},messageHandle:function(t){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function s(){var n,a,i;return regeneratorRuntime.wrap((function(s){while(1)switch(s.prev=s.next){case 0:if(-1===t.cmdId&&e.$message(t.msg),301!==t.cmdId){s.next=17;break}if(n=t.body,n.ext.messageType!==D["a"].prompt){s.next=9;break}return e.promptData=n.ext,e.promptShow=!0,s.abrupt("return");case 9:if(a={createTime:n.time,fromUsername:n.ext.from,id:n.ext.messageId,messageBody:e.messageBodyHandle(n),messageType:n.ext.messageType,toUsername:e.user.userName,updateTime:n.time,fromAvatar:n.ext.fromAvatar,nickname:n.ext.fromNick,relation:n.ext.relation,isread:!1,ttye:"accept"},!Object(p["f"])(e.chatName,n.ext.from)||4===+n.ext.messageType){s.next=16;break}return e.user.curUserHistory.push(a),i=[n.ext.messageId],s.next=15,d["a"].upMsgStatus({toUsername:e.user.userName,ids:i,status:3});case 15:a.isread=!0;case 16:e.updateChatlist(a);case 17:case"end":return s.stop()}}),s)})))()},messageBodyHandle:function(t){if(3===t.ext.messageType)return t.ext.extra;if(6===t.ext.messageType)return t.ext;try{return JSON.parse(t.message)}catch(e){return{}}},sendMessageHandle:function(){var t=this;if(!this.isSending){var e=this.comment.trim();e?(this.isSending=!0,this.chat.sendMessage(e).then((function(e){t.isSending=!1,e&&200===+e.code?t.comment="":t.$message(e.message)}),(function(e){t.isSending=!1,t.$message(e)}))):this.$message("请输入内容")}},promptClose:function(){var t=this;m["a"].closeBubble({target:this.promptData.from,opreateTab:1}).then((function(){t.promptShow=!1}))},promptConfirm:function(){var t=this,e={follow:this.promptData.from};m["a"].follow(e).then((function(e){e.status?(t.promptShow=!1,t.updateChatUserRelation({username:t.promptData.from,relation:0===+t.promptData.relation?3:1})):t.$message({message:e.message,type:"error"})}))},menuChange:function(){this.promptShow=!1}}),watch:{$route:{handler:function(t,e){this.chatName=this.$route.params.id||""},immediate:!0}}},mt=dt,pt=(s("1c79"),Object(A["a"])(mt,n,a,!1,null,"1b6ac0fa",null));e["default"]=pt.exports},e2e2:function(t,e,s){},fb44:function(t,e,s){"use strict";s("e2e2")}}]);